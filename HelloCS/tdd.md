# TDD(Test Driven Development)와 단위 테스트

## TDD(Test Driven Development)

- 테스트 코드를 먼저 만들고, 실제 프로덕션 코드를 나중에 만드는 개발 방법을 말한다.

  <img src="https://images.velog.io/images/inapeace/post/d723c2ed-05c1-42b0-a2af-46694e964b8e/TDD_Process.jpg" alt="tdd" width="50%" >

그림처럼 원래는 `설계` &rarr; `개발(코드작성)` &rarr; `테스트` 순서로 개발한다면 `TDD`는 `설계` &rarr; `테스트(코드작성)` &rarr; `개발` 순서로 테스트 코드를 먼저 작성하고 나중에 개발하는 개발 과정을 거친다.

- TDD를 사용하는 이유?
  - 리팩토링이 편하다.
  - 디버깅하는 시간을 줄여준다.
  - 동작하는 문서 역할을 한다.
  - 자연스럽게 테스트커버리지가 높아진다. (테스트 커버리 : 시스템 또는 소프트웨어의 테스트를 논할 때 얼마나 테스트가 충분한가를 나타낸 것이다.)
  - 요구 사항에 맞춰 개발 코드를 구현하기 때문에 오버 엔지니어링을 방지한다.
  - 설계에 대한 피드백이 빠르다. 설께 수정이 용이하다.

### TDD 개발 사이클

<img src="https://i0.wp.com/hanamon.kr/wp-content/uploads/2021/04/TDD-%E1%84%80%E1%85%A2%E1%84%87%E1%85%A1%E1%86%AF%E1%84%8C%E1%85%AE%E1%84%80%E1%85%B5.png?fit=1024%2C680&ssl=1" alt="tdd-process" width="50%" />  
  
해당 그림은 **Red, Green, Refactor**라는 TDD 개발 사이클을 그림으로 나타낸 것이다.  
  
**1. Red** : 실패하는 테스트를 구현한다.  
**2. Green** : 테스트가 성공하도록 프로덕션 코드를 구현한다.  
**3. Refactor** : 프로덕션 코드와 테스트 코드를 리팩토링한다.

## 단위 테스트(Unit test)

### 단위 테스트의 범위

<img src="https://images.velog.io/images/sdb016/post/ab827ab1-c299-4203-9cb3-a41932d45178/image.png" alt="test" />  
  
- 통합 테스트 : 여러 작업 단위가 연계된 워크 플로우를 테스트하기 위한 수단(객체 간, 서비스 간, 시스템 간)  
- 기능 테스트 : 공개된 API릐 가장 바깥쪽에 해당하는 코드 검사(Controller 호출, Security, http)  
- 부하 테스트 : 주어진 단위 시간 동안 어플리케이션이 얼마나 많은 요청을 처리할 수 있는지 검사  
- 인수 테스트 : 고객 또는 대리인이 정의되어진 모든 목적에 부합되는지 확인해보고지 하는 검사
  
제일 마지막인 단위 테스트는 제일 기본이 되는 테스트이며 점점 더 범위를 넓혀나가며 테스트를 하게 된다.  
  
- 단위 테스트 :  
  - 가장 작은 단위의 테스트이다.  
  - 일반적인 메서드 레벨을 테스트한다.  
  - 검증이 필요한 코드에 대해 테스트 케이스를 작성하는 절차 또는 프로세스이다.
  - 단위 테스트는 테스트 코드가 목적 코드의 완전성을 입증 해주기 때문에, 테스트 코드 그 자체만으로 주요한 가치가 있음

### 목적

1. 문제점 발견  
   : 단위 테스트는 각 단위가 정확하게 동작하는지 검사하고 문제 발생 시 어느 부분이 잘못되었는지 재빨리 확인할 수 있게 한다. 즉, 프로그램 안정성이 높아진다.

2. 변경이 쉽다.  
   : 문제점을 빨리 발견하면서 코드 수정이 쉬워지고 수정된 코드가 정확하게 동작하는지 쉽게 알 수 있으므로 변경이 쉬워집니다.

3. 픔질 향상  
   : 하나의 단위 테스트가 너무 길어지거나 복잡해진다면 프로덕션 코드에서 잘못되었다고 생각할 수 있다. 이는 리팩토링이 필요하다는 뜻이며 리팩토링을 통해 품질을 향상 시킬 수 있다.

4. 코드의 문서화(샘플 코드)  
   : 예외 상황, 용도, 의전 관계를 한눈에 파악할 수 있습니다.

### 좋은 단위 테스트 작성 법칙(F.I.R.S.T)

- **F** - 빠르게(fast)
  - 테스트는 빨라야 한다. 테스트가 느리면 자주 돌릴 엄두를 못 낸다. 자주 돌리지 않으면 초반에 문제를 찾아내 고치지 못한다. 결국 코드 품질이 망가지기 시작한다.
- **I** - 독립적으로(Independent)
  - 각 테스트를 서로 의존하면 안 된다. 테스트가 서로에게 의존하면 하나가 실패할 때 나머지도 잇달아 실패하므로 원인을 진단하기 어려워지며 후반 테스트가 찾아내야 할 결함이 숨겨진다.
- **R** - 반복 가능하게(Repeatable)
  - 테스트는 어떤 환경에서도 반복 가능해야 한다. 테스트가 돌아가지 않는 환경이 하나라도 있다면 테스트가 실패한 이유를 둘러댈 변명이 생긴다. 게다가 환경이 지원되지 않기에 테스트를 수행하지 못하는 상황에 직면한다.
- **S** - 자가 검증하는(Self-Validating)
  - 테스트는 bool값으로 결과를 내야 한다. 성공 아니면 실패다. 통과 여부를 알리고 로그 파일을 읽게 만들어서는 안 된다.
- **T** - 적시에(Timely)
  - 테스트는 적시에 작성해야 한다. 단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현한다. 실제 코드를 구현한 다음에 테스트 코드를 만들면 실제 코드가 테스트하기 어렵다는 사실을 발견할지도 모른다.  
    즉, 테스트가 불가능하도록 실제 코드를 설계할지도 모른다.
